<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trackify</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="logo.webp" type="image/x-icon">
</head>

<body>
    <div class="container">
        <div class="sidebar">
            <img src="logo.webp" alt="User">
            <ul class="menu">
                <li class="active"><a href="index.html">üè† Home</a></li>
                <li><a href="expenses.html">üí∞ Expenses</a></li>
                <li><a href="teams.html">üë• Teams</a></li>
                <li><a href="approvals.html">‚úÖ Approvals</a></li>
                <li><a href="reports.html">üìä Reports</a></li>
                <li><a href="support.html">üìû Support</a></li>
                <li><a href="#" onclick="logout()">üî¥ Logout</a></li>


            </ul>
        </div>

        <div class="main">
            <h2>Welcome to Dashboard</h2>


            <div class="dashboard-cards">
                <div class="card">
                    <h3>Total Expenses</h3>
                    <p class="stat" id="totalExpenses">‚Çπ0</p>
                </div>
                <div class="card">
                    <h3>Pending Approvals</h3>
                    <p class="stat" id="pendingCount">0</p>
                </div>
                <div class="card">
                    <h3>Team Members</h3>
                    <p class="stat" id="teamCount">0</p>
                </div>
                <div class="card">
                    <h3>This Month</h3>
                    <p class="stat" id="monthlyTotal">‚Çπ0</p>
                </div>
            </div>

            <div class="quick-actions">
                <h3>Quick Actions</h3>
                <a href="expenses.html" class="action-btn">Add New Expense</a>
                <a href="approvals.html" class="action-btn">View Approvals</a>
                <a href="reports.html" class="action-btn">Generate Report</a>
            </div>
        </div>
    </div>



    <script>
        let pendingApproval = [];//expenses
        let approvalExpenses = [];//approval
        let teamMembers = [];

        function saveData() {
            localStorage.setItem('teamMember', JSON.stringify(teamMembers))
            localStorage.setItem('pendingApproval', JSON.stringify(pendingApproval))
            localStorage.setItem('approvalExpenses', JSON.stringify(approvalExpenses))
        }

        function loadData() {
            teamMembers = JSON.parse(localStorage.getItem('teamMember'))
            approvalExpenses = JSON.parse(localStorage.getItem('approvalExpenses'))
            pendingApproval = JSON.parse(localStorage.getItem('pendingApproval'))
        }

        window.onload = () => {
            loadData();
        }

        function submitExpense() {
            let amount = document.getElementById('amount').value;
            let date = document.getElementById('date').value;
            let assignedTo = document.getElementById('assignedTo').value;
            let category = document.getElementById('category').value;
            let description = document.getElementById('description').value;

            if (!amount || !date || !assignedTo || !category || !description) {
                alert('please fill the necessary fields')
            }

            //all the data is stored in object literal
            let expense = { amount, date, assignedTo, category, description };
            pendingApproval.push(expense);
            alert('submit expense is successfull')
            document.getElementById('amount').innerHTML = "";
            document.getElementById('date').innerHTML = "";
            document.getElementById('category').innerHTML = "";
            document.getElementById('description').innerHTML = "";

            return;
        }

        //adding members
        function addTeamMember() {
            let member = document.getElementById('assignedTo').value;

            if (!member) {
                alert('Enter the member')
                return;
            }
            //push the data to team members
            teamMembers.push(member)
            document.getElementById('assignedTo').innerHTML = "";
        }

        function renderTeam() {
            let teamList = document.getElementById('teamList')
            teamList.innerText = "";
            teamMembers.forEach((member) => {

                let memberList = document.createElement('li');
                li.innerHTML = "";
                teamList.append(memberList);
                document.getElementById('membercount').innerHTML = member.length;

            })
        }

        function approval() {
            let approvalList = document.getElementById('approvalList').value;

            approvalList.innerHTML = "";
            approvalList.forEach((x) => {
                let div = document.createElement('div');
                div.classList = "approve";
                div.innerHTML = `${x.amount}-${x.date}-${x.category}-[${x.description}](${x.assignedTo})`;

                //approve button
                let approveBtn = document.createElement('button')
                approveBtn.innerHTML = ""
                approveBtn.classList = "approve";

                //reject button
                let rejectBtn = document.createElement('button');
                rejectBtn.innerHTML = "";
                rejectBtn.classList = 'reject'

                if (pendingApproval === 0) //if expenses is 0
                {
                    alert("no approvals")
                    return;
                }
                div.appendChild(approveBtn);
                div.appendChild(rejectBtn);
            })
        }

        function generateReport() {
            let reportOutput = document.getElementById("reportOutput");
            reportOutput.innerHTML = "";

            if (approvalExpenses.length === 0 && pendingApproval.length === 0) {
                alert("No expenses available to generate report");
                return;
            }

            let totalApproved = 0;
            let totalPending = 0;

            for (let i = 0; i < approvalExpenses.length; i++) {
                totalApproved += Number(approvalExpenses[i].amount);
            }

            for (let j = 0; j < pendingApproval.length; j++) {
                totalPending += Number(pendingApproval[j].amount);
            }

            // Show report details
            let reportText = "<h3>Expense Report</h3>";
            reportText += "<p><b>Total Approved:</b> ‚Çπ" + totalApproved + "</p>";
            reportText += "<p><b>Total Pending:</b> ‚Çπ" + totalPending + "</p>";

            reportText += "<h4>Approved Expenses:</h4><ul>";
            for (let i = 0; i < approvalExpenses.length; i++) {
                let exp = approvalExpenses[i];
                reportText += "<li>" + exp.date + " - " + exp.category + " - ‚Çπ" + exp.amount + " - " + exp.assignedTo + "</li>";
            }
            reportText += "</ul>";

            reportText += "<h4>Pending Expenses:</h4><ul>";
            for (let j = 0; j < pendingApproval.length; j++) {
                let exp = pendingApproval[j];
                reportText += "<li>" + exp.date + " - " + exp.category + " - ‚Çπ" + exp.amount + " - " + exp.assignedTo + "</li>";
            }
            reportText += "</ul>";

            reportOutput.innerHTML = reportText;
        }


        function sendSupport() {
            let name = document.getElementById("supportName").value;
            let message = document.getElementById("supportMessage").value;
            let response = document.getElementById("supportResponse");

            if (!name || !message) {
                alert("Please fill out both fields");
                return;
            }

            response.innerHTML = "‚úÖ Thank you, " + name + ". Your message has been received: \"" + message + "\"";

            // clear inputs
            document.getElementById("supportName").value = "";
            document.getElementById("supportMessage").value = "";
        }

        // Update dashboard stats on load
        window.onload = function () {
            loadDashboardStats();
        };

        function loadDashboardStats() {
            const approvedExpenses = JSON.parse(localStorage.getItem('approvedExpenses')) || [];
            const pendingApprovals = JSON.parse(localStorage.getItem('pendingApprovals')) || [];
            const teamMembers = JSON.parse(localStorage.getItem('teamMembers')) || [];

            const totalAmount = approvedExpenses.reduce((sum, expense) => sum + Number(expense.amount), 0);
            const currentMonth = new Date().getMonth();
            const monthlyTotal = approvedExpenses
                .filter(expense => new Date(expense.date).getMonth() === currentMonth)
                .reduce((sum, expense) => sum + Number(expense.amount), 0);

            document.getElementById('totalExpenses').textContent = '‚Çπ' + totalAmount;
            document.getElementById('pendingCount').textContent = pendingApprovals.length;
            document.getElementById('teamCount').textContent = teamMembers.length;
            document.getElementById('monthlyTotal').textContent = '‚Çπ' + monthlyTotal;
        }

        //logout
        function logout() {
            let confirmLogout = confirm("Are you sure you want to log out?");
            if (confirmLogout) {
                // Clear stored data
                localStorage.clear();

                // Redirect to signup page
                window.location.href = "signup.html";
            } else {
                // User canceled logout
                return;
            }
        }
        

        // Block back button navigation
        window.history.pushState(null, "", window.location.href);
        window.onpopstate = function () {
            window.history.pushState(null, "", window.location.href);
        };


    </script>
</body>

</html>